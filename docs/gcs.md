# Google Cloud Storage

**Note:** to apply the all permissive CORS policy to a new bucket, run:
`gsutil cors set util/gs-cors.json gs://[BUCKET]`

Here are the buckets used by this project. Most of them have a `*-staging`
counterpart for the `wptdashboard-staging` project.

## wptd

This is a publicly readable bucket (with an all-permissive CORS policy) that
serves the test results on wpt.fyi. The bucket has wpt.fyi-internal result
summary files and results for individual tests for each test run. Generally, you
shouldn't directly consume this bucket. Please see the
[wptd-results](#wptdresults) bucket below if you want to fetch the raw results.

The directory schema is roughly:

* `[SHA] (full or short)`
    * `[product-id]-summary.json.gz`
    * `[product-id]`
        * Split JSONs with the same directory hierarchy as tests in WPT...

(See [wptd-results](#wptdresults) for the definition of `[product-id]`.)

## wptd-results

This is a publicly readable bucket (with an all-permissive CORS policy) that
contains full raw results (`wptreport.json` generated by `wpt run`). The wpt.fyi
frontend currently doesn't serve files from this bucket, but various APIs
return `raw_results_url` pointing to this bucket.

The directory schema is roughly:

* `[Full SHA]`
    * `[product-id]`
        * `report.json`

where
* `[product-id] := [browser]-[version]-[os]{-[os_version]}{-[checksum]}`
* `[browser] := {chrome, edge, firefox, safari, â€¦}`
* `[version]`, a version string, preferably output by `browser-binary --version`,
   with anything other than `[A-Za-z0-9_.-]` replaced by underscores (e.g.
   "61.0a1", "68.0.3409.2_dev")
* `[os] := {linux, windows, macos, android, ios}`
* `[os_version]`, a version string similarly sanitized as `[version]`
* `[checksum]`, some checksum of the wptreport.json served as a UID to
   differentiate multiple runs of the same version of a browser at the same sha;
   currently, it's a prefix of the SHA1 of the report.

Users who want to fetch the raw history results should not try to construct the
URL themselves, as `[product-id]` has many optional parts and even a checksum.
Instead, please use the [APIs](../api/README.md) to query test runs and download
the `raw_results_url` of the test runs.
