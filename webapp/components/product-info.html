<dom-module id="browser-info">
  <script>
    const DISPLAY_NAMES = (() => {
      let m = new Map();
      ['chrome', 'chrome-experimental'].forEach(n => m.set(n, 'Chrome'));
      ['edge', 'edge-experimental'].forEach(n => m.set(n, 'Edge'));
      ['firefox', 'firefox-experimental'].forEach(n => m.set(n, 'Firefox'));
      ['safari', 'safari-experimental'].forEach(n => m.set(n, 'Safari'));
      m.set('uc', 'UC Browser');
      m.set('android', 'Android');
      m.set('linux', 'Linux');
      m.set('macos', 'macOS');
      m.set('windows', 'Windows');
      // Channels
      m.set('stable', 'Stable');
      m.set('beta', 'Beta');
      m.set('dev', 'Dev');
      m.set('experimental', 'Experimental');
      return m;
    })();
    const VERSION_PATTERNS = {
      major: /(\d+)/,
      majorAndMinor: /(\d+\.\d+)/
    };
    const CHANNELS = new Set(['stable', 'beta', 'dev', 'experimental']);

    // eslint-disable-next-line no-unused-vars
    const ProductInfo = (superClass) => class extends superClass {
      static get properties() {
        return {
        };
      }

      displayName(name) {
        return DISPLAY_NAMES.get(name) || name;
      }

      displayLabels(labels) {
        if (labels && labels instanceof Array) {
          return labels.join(', ');
        }
        return '';
      }

      minorIsSignificant(browserName) {
        return browserName === 'safari';
      }

      /**
       * Truncate a software version identifier to include only the most
       * salient information for the specified browser.
       */
      shortVersion(browserName, browserVersion) {
        const pattern = this.minorIsSignificant(browserName) ?
          VERSION_PATTERNS.majorAndMinor : VERSION_PATTERNS.major;
        const match = pattern.exec(browserVersion);

        if (!match) {
          return browserVersion;
        }

        return match[1];
      }

      getSpec(product) {
        let spec = product.browser_name;
        if (product.browser_version) {
          spec += `-${product.browser_version}`;
        }
        if (product.labels && product.labels.length) {
          spec += `[${product.labels.join(',')}]`;
        }
        if (product.revision && !isLatest(product.revision)) {
          spec += `@${product.revision}`;
        }
        return spec;
      }

      isLatest(sha) {
        return !sha || sha === 'latest';
      }
    }
  </script>
</dom-module>
