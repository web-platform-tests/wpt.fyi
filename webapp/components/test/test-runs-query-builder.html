<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../bower_components/web-component-tester/browser.js"></script>

  <link rel="import" href="../test-runs-query-builder.html">
</head>
<body>
  <test-runs-query-builder product-specs='["chrome[experimental]","edge"]' edit debug>
  </test-runs-query-builder>

  <test-fixture id="product-builder-fixture">
    <template>
      <product-builder></product-builder>
    </template>
  </test-fixture>

  <script>
    suite('TestRunsQueryBuilder', () => {
      let queryBuilder;

      setup(() => {
        queryBuilder = document.querySelector('test-runs-query-builder');
      });

      test('instanceof Polymer.Element', () => {
        assert.isTrue(queryBuilder instanceof window.Polymer.Element);
      });

      test('TestRunsQueryBuilder.prototype.*', () => {
        assert.isNotNull(queryBuilder.products);
        assert.isNotNull(queryBuilder.products.find(p => p.browser_name === 'chrome'));
        assert.isNotNull(queryBuilder.products.find(p => p.browser_version === '69'));
      });
    });

    suite('ProductBuilder', () => {
      let productBuilder;

      setup(() => {
        productBuilder = fixture('product-builder-fixture');
        productBuilder.product = {browser_name: 'chrome'};
      });

      suite('ProductBuilder.prototype.*', () => {
        suite('channel', () => {
          test('updates the labels when value changes', () => {
            productBuilder.channel = 'stable';
            assert.isTrue(productBuilder.product.labels.includes('stable'));
          });
          test('updates the spec when value changes', () => {
            productBuilder.channel = 'dev';
            assert.equal(productBuilder.spec, 'chrome[dev]');
          });

          test('changes value when labels are updated', () => {
            productBuilder.set('product.labels', ['experimental']);
            assert.equal(productBuilder.channel, 'experimental');
          });
        });
      });
    });
  </script>
</body>
</html>
