# Copyright 2019 The WPT Dashboard Project. All rights reserved.
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

# This is a copy of app.yaml that has static directories relative to webapp/web,
# because dev_appserver.py does not use go.mod as the pointer to the root folder.

runtime: go111
instance_class: F4_1G

inbound_services:
- warmup

default_expiration: "1d"

env_variables:
  TASKCLUSTER_ROOT_URL: https://taskcluster.net

# Also refer to dispatch.yaml for higher-priority routing rules.
handlers:
# Remote API
- url: /_ah/remote_api
  script: auto
# Special dynamic components:
- url: /components/wpt-env-flags.js
  script: auto
  secure: always
- url: /node_modules/.*
  script: auto
  secure: always
# Static files:
- url: /static
  static_dir: ../static
  secure: always
- url: /service-worker-installer.js
  static_files: ../service-worker-installer.js
  upload: service-worker-installer.js
  secure: always
- url: /service-worker-uninstaller.js
  static_files: ../service-worker-uninstaller.js
  upload: service-worker-uninstaller.js
  secure: always
- url: /favicon.ico
  static_files: ../static/favicon.ico
  upload: static/favicon.ico
  secure: always
# Static files that change often (i.e. our own code).
- url: /components
  static_dir: ../components
  expiration: 10m
  secure: always
- url: /views
  static_dir: ../views
  expiration: 10m
  secure: always

# Admin-only pages:
- url: /admin/.*
  script: auto
  secure: always
  login: admin

# Remote API
- url: /_ah/remote_api
  script: _go_app

# Everything else (templates & APIs):
- url: /.*
  script: auto
  secure: always
